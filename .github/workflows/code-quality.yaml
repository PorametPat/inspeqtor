name: Python Code Quality
on: [push]
jobs:
    lock_file:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
            - uses: ./.github/actions/setup
            - run: uv lock --locked
    linting:
        runs-on: ubuntu-latest
        needs: [lock_file]
        steps:
            - uses: actions/checkout@v4
            - uses: ./.github/actions/setup
            - run: uvx ruff check .
    formatting:
        runs-on: ubuntu-latest
        needs: [lock_file]
        steps:
            - uses: actions/checkout@v4
            - uses: ./.github/actions/setup
            - run: uvx ruff format .
            - run: uvx ruff format --check .
    type_checking:
        runs-on: ubuntu-latest
        needs: [lock_file]
        steps:
            - uses: actions/checkout@v4
            - uses: ./.github/actions/setup
            - run: uv run pyright src/inspeqtor/experimental/.
    tests_py3-13:
        runs-on: ubuntu-latest
        needs: [lock_file]
        steps:
            - uses: actions/checkout@v4
            - uses: ./.github/actions/setup
            - run: uv run --python 3.13 --with '.[test]' pytest tests/experimental/. -vv --durations=0
    tests_py3-12:
        runs-on: ubuntu-latest
        needs: [lock_file]
        steps:
            - uses: actions/checkout@v4
            - uses: ./.github/actions/setup
            - run: uv run --python 3.12 --with '.[test]' pytest tests/experimental/. -vv --durations=0
    tests_py3-11:
        runs-on: ubuntu-latest
        needs: [lock_file]
        steps:
            - uses: actions/checkout@v4
            - uses: ./.github/actions/setup
            - run: uv run --python 3.11 --with '.[test]' pytest tests/experimental/. -vv --durations=0
    build:
        runs-on: ubuntu-latest
        needs: [lock_file, linting, formatting, tests]
        steps:
            - uses: actions/checkout@v4
            - uses: ./.github/actions/setup
            - run: uv build